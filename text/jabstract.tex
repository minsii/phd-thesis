近年、マルチコアプロセッサが広く普及しているが、消費電力と発熱問題など
の理由により、従来通りの動作周波数向上によるプロセッサ処理性能向上は困
難になっており、コアを増やして更なる並列化により性能を向上するしかない。
インテル社のXeon Phiや、IBM社のBlue Gene/Qなどのメニーコアアーキテク
チャーは数十コア・数百ハードウェアスレッドのような大規模並列環境を提供している。
このようなアーキテクチャーのハードウェアの特徴をまとめると、一つは膨大
なコア数により大規模並列計算環境が提供されていること、もう一つは省エネ
ルギーのために各プロセッサコアの動作周波数が低く抑えされるていることである。
これらの特徴からメニーコアの性能を発揮するには、なるべくアプロケーショ
ン全体を大規模並列化しなければならないが、逆に並列コア数が不足する場合、
性能が悪化することも注意しなければならない。科学計算アプリケーションプロ
グラマーは、大量のコアを有効利用し高性能計算を達成するために様々な計算・通信
プログラミングモデルに注目している。

計算の面から見ると、メモリやその他のシステム資源に比べて大量のコアが提供
されてきている理由から、プロセスとスレッドを混在させるハイブリッドプロ
グラミングモデルに移行している例がある。このようなモデルでは、同一プロセス
に所属する複数スレッドがノード内資源を共有することが可能となる。スレッド
モデルの代表的処理系であるOpenMPと分散メモリシステム上で通信機能を担当
するMPIライブラリの組み合わせがこのモデルの主流である。
ハイブリッドMPI+スレッド型プログラミングが増加しているが、1 MPIプロセ
スが1コア上で走るMPIプロセスだけのプログラミングモデルを採用している
アプリケーションもある。

通信面から見ると、分散メモリシステム上ではメッセージパッシングが通信モ
デルの主流であり、その代表的通信モデルがMPIである。MPIの処理は同期と非同期処理に分けられる。
双方向送受信通信において、メッセージ到着を待つブロッキング送信は同期処
理の一例であり、メッセージ送信の完了を待たずにアプリケーションに処理が
戻るノンブロッキング送信は非同期通信の一例である。
更に、MPI-2規格から定義された片方向通信、いわゆる「Remote Memory
Access、RMA」は、通信の相手の状態に無関係に他のプロセスのデータにアクセ
スできる通信モデルであり、特にInfiniBandやCray Aries、富士通Tofu インタ
コネクトなどのハードウェア片方向通信をサポートするネットワーク上ではよ
り効率的、自然的な非同期処理が実現されている。

アプリケーションの構成の違いにより、最適な計算・通信プログラミングモデ
ルがそれぞれある。しかしながら、メニーコア上でそれらのモデルを効率的に
実行する処理系は未成熟である。
本論文は、科学計算に広く用いられるメッセージパッシング通信モデルを対象
としてメニーコアの特徴を活用して通信性能を最大限に発揮し、あらゆるプロ
グラミングモデルの既存課題を解決して全体性能の向上に貢献する。

まず、ハイブリッドMPI+スレッド型アプリケーションでは、複数のOpenMP
スレッドが計算を並列化してその中の1つがMPI通信を行うという実行モデルが主流である。
このような実行パターンでは、浮動小数点計算を大規模並列化することにより
計算部分の性能向上が達成されるが、通信部分では殆どのスレッドがアイドル
になり、計算資源が無駄になる。また、1つのコアだけが通信処理を担当する
ことにより通信性能の劣化原因ともなる。本論文の第一の貢献は、この問題に
対してアイドル状態になったユーザアプリケーションが作成したスレッドを再
利用して、ユーザ定義データ型通信、共有メモリ通信とネットワークI/O作業
などのMPI内部通信作業を並列化する手法を提案する。本手法により、計算部
分だけでなく、通信を含めてアプリケーション全体がメニーコア資源を利用で
き、全体性能が向上することを示す。

次に、MPIプロセスだけで記述されたアプリケーションでは、大量のプロセスが
計算資源を占有することにより問題がある。例えば、1MPIプロセスがメッセー
ジを待つ時、メッセージが到着するまでその計算コアはアイドルになり、コア性
能を発揮できなくなる。本論文の第２の貢献としては、1コア上でOSプロセスを
複数スケジュールできるユーザレベルプロセスのアプローチに基づき、大量のMPI
プロセスを1コア上で実行して負荷分散やチェックポイントの軽量化などの面から
改良手法を提案する予定である。

最後に、非同期可能な通信処理がたくさんあっても、MPI規格ではこのような通
信が必ず非同期処理されるとは限らない問題点について取り組む。片方向通信
であっても、RMA通信を完了するためにリモート側プロセスがMPIを呼び出さな
いと処理が進まないMPI実装が殆どである。リモート側がMPIを呼び出すまで、
通信処理がローカル側で完了できず、更にリモート側が計算中のためローカル
プロセスが長時間待ちになる恐れもある。既存研究では、1プロセスが1ヘルプ
スレッドを生成してバックグラウンドで受信処理する手法が殆どであるが、こ
の場合半分の計算コアがヘルプスレッドに使われ計算資源の浪費となる。
更に、複数のスレッドが共有資源をアクセスするための同期コストが問題となる。
本論文の第３の貢献として、本課題に対してメニーコアの特徴を活用し、プロセ
スレベルでMPI非同期通信専用ヘルプコアを実装し、最適な非同期通信処理手法を
提案する予定である。本手法では、ユーザが任意的に計算プロセスに使うコア
数とヘルプコア数を指定でき、従来のスレッド型アプローチより優れた柔軟性
を達成するとともに、マルチスレッドレベルのオーバーヘットも軽減する。
更に、PMPIリダイレクト機能を利用したMPI外部実装方式を採用することにより、
あらゆるMPI実装にも容易にサポートできる利点もある。

